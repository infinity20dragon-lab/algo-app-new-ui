<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlgoSound</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}:root{--bg:#0a0e14;--bg2:#111820;--bg3:#1a2332;--card:#141c28;--border:#243044;--text:#e8edf4;--text2:#8899ab;--text3:#5c6f82;--blue:#4a9eff;--red:#ff5c5c;--orange:#ffaa4a;--green:#4aff9f;--purple:#a855f7}body{font-family:system-ui;background:var(--bg);color:var(--text)}.app{display:flex;min-height:100vh}.sidebar{width:260px;background:var(--bg2);border-right:1px solid var(--border);position:fixed;height:100vh;display:flex;flex-direction:column;z-index:100}.logo{padding:24px;border-bottom:1px solid var(--border);font-size:20px;font-weight:700}.logo span{color:var(--orange)}.nav{padding:16px 12px;flex:1;overflow-y:auto}.nav-label{font-size:10px;font-weight:600;text-transform:uppercase;color:var(--text3);padding:8px 12px;margin-top:8px}.nav-item{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:8px;cursor:pointer;color:var(--text2);margin-bottom:2px}.nav-item:hover{background:var(--bg3)}.nav-item.active{background:linear-gradient(135deg,rgba(74,158,255,0.15),rgba(74,255,234,0.08));color:var(--blue)}.main{flex:1;margin-left:260px}.header{padding:20px 32px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;justify-content:space-between;align-items:center}.content{padding:32px}.page{display:none}.page.active{display:block}.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;border:none;background:var(--blue);color:white;font-family:inherit;transition:all .2s}.btn:hover{background:#3d8ae6}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-sec{background:var(--bg3);color:var(--text);border:1px solid var(--border)}.btn-sec:hover{background:var(--card)}.btn-danger{background:var(--red);color:white}.btn-danger:hover{background:#e64a4a}.btn-sm{padding:6px 12px;font-size:12px}.btn-lg{padding:14px 28px;font-size:16px}.empty-state{text-align:center;padding:80px 20px}.empty-icon{font-size:60px;margin-bottom:20px}.empty-title{font-size:24px;font-weight:700;margin-bottom:12px}.empty-desc{font-size:14px;color:var(--text2);margin-bottom:32px;max-width:500px;margin-left:auto;margin-right:auto;line-height:1.6}.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:2000}.modal-overlay.active{display:flex}.modal{background:var(--card);border:1px solid var(--border);border-radius:20px;width:800px;max-width:95vw;max-height:85vh;display:flex;flex-direction:column}.modal-header{padding:24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-title{font-size:20px;font-weight:700}.modal-body{padding:24px;overflow-y:auto;flex:1}.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:12px}.form-group{margin-bottom:20px}.form-label{display:block;font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px}.form-input,.form-select{width:100%;padding:12px 16px;background:var(--bg3);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;font-family:inherit}.form-input:focus,.form-select:focus{outline:none;border-color:var(--blue)}.form-input.error{border-color:var(--red)}.form-error{font-size:12px;color:var(--red);margin-top:4px;display:none}.form-error.show{display:block}.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px}.stat-val{font-size:28px;font-weight:700;margin:12px 0 4px;font-family:monospace}.stat-lbl{font-size:13px;color:var(--text2)}.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:24px}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.card-title{font-size:16px;font-weight:600}.status-indicator{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;font-size:12px;font-weight:600}.status-indicator.good{background:rgba(74,255,159,0.15);color:var(--green)}.status-indicator.bad{background:rgba(255,92,92,0.15);color:var(--red)}.zone-list{display:flex;flex-direction:column;gap:12px}.zone-item{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:16px;display:flex;justify-content:space-between;align-items:center;transition:all .2s}.zone-item:hover{border-color:var(--blue)}.zone-info{flex:1}.zone-name{font-weight:600;margin-bottom:4px}.zone-meta{font-size:12px;color:var(--text3)}.device-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;display:flex;align-items:center;gap:16px}.device-icon{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px}.device-info{flex:1}.device-name{font-weight:600;margin-bottom:4px}.device-meta{font-size:12px;color:var(--text3);font-family:monospace}.adapter-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px}.routing-matrix{background:var(--bg3);border-radius:12px;padding:20px}.routing-row{display:grid;grid-template-columns:200px 1fr 1fr 1fr;gap:16px;padding:12px 0;border-bottom:1px solid var(--border);align-items:center}.routing-row:last-child{border-bottom:none}.routing-row.header{font-weight:600;color:var(--text2);font-size:13px}.checkbox{width:20px;height:20px;border:2px solid var(--border);border-radius:6px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.checkbox:hover{border-color:var(--blue)}.checkbox.checked{background:var(--blue);border-color:var(--blue)}.checkbox.checked::after{content:'‚úì';color:white;font-size:12px;font-weight:bold}.checkbox.readonly{cursor:default}.checkbox.readonly:hover{border-color:var(--border)}.debug-drawer{position:fixed;bottom:0;right:0;width:400px;max-height:300px;background:var(--card);border:1px solid var(--border);border-radius:12px 0 0 0;z-index:3000;display:flex;flex-direction:column}.debug-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;font-size:12px;font-weight:600}.debug-body{padding:12px;overflow-y:auto;flex:1;font-family:monospace;font-size:11px}.debug-entry{padding:4px 0;border-bottom:1px solid var(--border)}.debug-entry.error{color:var(--red)}.debug-entry.click{color:var(--blue)}.debug-entry.nav{color:var(--green)}.toast{position:fixed;top:80px;right:20px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px 20px;z-index:2500;min-width:300px;animation:slideIn .3s}.toast.success{border-color:var(--green)}.toast.error{border-color:var(--red)}@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}.audio-lane{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px}.audio-lane.fire{border-color:rgba(255,92,92,0.4)}.audio-lane.medical{border-color:rgba(74,158,255,0.4)}.audio-lane.all{border-color:rgba(168,85,247,0.4)}.audio-lane-title{font-size:15px;font-weight:600;margin-bottom:16px}.audio-lane.fire .audio-lane-title{color:var(--red)}.audio-lane.medical .audio-lane-title{color:var(--blue)}.audio-lane.all .audio-lane-title{color:var(--purple)}
</style>
</head>
<body>
<div class="app">
<nav class="sidebar"><div class="logo">Algo<span>Sound</span></div><div class="nav"><div class="nav-label">Overview</div><div class="nav-item active" data-action="nav" data-page="dashboard">Dashboard</div><div class="nav-item" data-action="nav" data-page="audio">Audio Workflow</div><div class="nav-label">Configuration</div><div class="nav-item" data-action="nav" data-page="zones">Zones</div><div class="nav-item" data-action="nav" data-page="devices">Devices</div><div class="nav-item" data-action="nav" data-page="integrations">Integrations</div><div class="nav-label">System</div><div class="nav-item" data-action="nav" data-page="settings">Settings</div></div></nav>
<main class="main"><header class="header"><div><h1 id="pageTitle">Dashboard</h1><p id="pageSub" style="font-size:14px;color:var(--text2);margin-top:4px">No station configured</p></div><button class="btn" data-action="setup-wizard" id="setupBtn">Setup Station</button></header><div class="content">
<div class="page active" id="page-dashboard"><div id="emptyDash"><div class="empty-state"><div class="empty-icon">üè¢</div><div class="empty-title">Station Not Configured</div><div class="empty-desc">Welcome to AlgoSound. Configure audio inputs, zones, and routing rules.</div><button class="btn btn-lg" data-action="setup-wizard">Setup Station</button></div></div><div id="activeDash" style="display:none"><div class="grid-4"><div class="stat"><div style="color:var(--blue);font-size:20px">üé§</div><div class="stat-val" id="stat-inputs">0/3</div><div class="stat-lbl">Audio Inputs Active</div></div><div class="stat"><div style="color:var(--green);font-size:20px">üîä</div><div class="stat-val" id="stat-speakers">0</div><div class="stat-lbl">Speakers</div></div><div class="stat"><div style="color:var(--orange);font-size:20px">üìç</div><div class="stat-val" id="stat-zones">0</div><div class="stat-lbl">Zones</div></div><div class="stat"><div style="color:var(--purple);font-size:20px">üì°</div><div class="stat-val" id="stat-8301">0</div><div class="stat-lbl">Algo 8301</div></div></div><div class="card"><div class="card-header"><h3 class="card-title">Audio Status</h3></div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px"><div><div style="font-size:13px;font-weight:600;color:var(--red);margin-bottom:8px">üî• Fire</div><div class="status-indicator bad" id="status-fire"><span>‚óè</span> Not Config</div></div><div><div style="font-size:13px;font-weight:600;color:var(--blue);margin-bottom:8px">üè• Medical</div><div class="status-indicator bad" id="status-med"><span>‚óè</span> Not Config</div></div><div><div style="font-size:13px;font-weight:600;color:var(--purple);margin-bottom:8px">üì¢ All-Call</div><div class="status-indicator bad" id="status-all"><span>‚óè</span> Not Config</div></div></div></div></div></div>
<div class="page" id="page-audio"><div id="emptyAudio"><div class="empty-state"><div class="empty-icon">üé§</div><div class="empty-title">Audio Workflow Not Configured</div><div class="empty-desc">Configure during setup.</div><button class="btn" data-action="setup-wizard">Setup Station</button></div></div><div id="activeAudio" style="display:none"></div></div>
<div class="page" id="page-zones"><div id="emptyZones"><div class="empty-state"><div class="empty-icon">üìç</div><div class="empty-title">No Zones</div><div class="empty-desc">Define zones during setup.</div><button class="btn" data-action="setup-wizard">Setup Station</button></div></div><div id="activeZones" style="display:none"></div></div>
<div class="page" id="page-devices"><div id="devicesContent"><div class="empty-state"><div class="empty-icon">üì°</div><div class="empty-title">No Speakers</div><div class="empty-desc">Scan network after setup.</div><button class="btn btn-lg" data-action="setup-wizard">Setup First</button></div></div></div>
<div class="page" id="page-integrations"><div class="empty-state"><div class="empty-icon">üîó</div><div class="empty-title">Integrations</div><div class="empty-desc">Coming soon...</div></div></div>
<div class="page" id="page-settings"><div class="card"><div class="card-header"><h3 class="card-title">Station</h3></div><div class="form-group"><label class="form-label">Station Name</label><input class="form-input" id="settingsName" disabled value="Not configured"/></div></div></div>
</div></main>
</div>
<div class="modal-overlay" id="modal"></div>

<script>
const APP={station:null,zones:[],speakers:[],routing:{fire:[],medical:[],all:[]},inputs:[{id:1,name:'Line In 1',type:null},{id:2,name:'Line In 2',type:null},{id:3,name:'Line In 3',type:null}],adapters:[],wizard:{step:1,data:{},dirty:false},editIndex:null};document.addEventListener('click',e=>{const a=e.target.closest('[data-action]');if(!a)return;const t=a.dataset.action;if(t==='nav')navigateTo(a.dataset.page,a);else if(t==='setup-wizard')startWizard();else if(t==='close-modal')closeModal();else if(t==='wizard-prev')wizardPrev();else if(t==='wizard-next')wizardNext();else if(t==='wizard-save')wizardSave();else if(t==='load-template')loadTemplate();else if(t==='add-zone-wizard')addZoneWizard();else if(t==='remove-zone-wizard')removeZoneWizard(parseInt(a.dataset.index));else if(t==='toggle-routing')toggleRouting(a.dataset.type,parseInt(a.dataset.index));else if(t==='add-zone')openZoneModal();else if(t==='edit-zone')openZoneModal(parseInt(a.dataset.index));else if(t==='delete-zone')deleteZone(parseInt(a.dataset.index));else if(t==='scan-network')scanNetwork(a);else if(t==='add-device')openDeviceModal();else if(t==='assign-speaker')openAssignModal(parseInt(a.dataset.index));else if(t==='change-input')openInputModal(a.dataset.type);else if(t==='add-8301')open8301Modal();else if(t==='edit-8301')open8301Modal(parseInt(a.dataset.index));else if(t==='remove-8301')remove8301(parseInt(a.dataset.index));else if(t==='save-zone')saveZone();else if(t==='save-device')saveDevice();else if(t==='save-assign')saveAssign();else if(t==='save-input')saveInput();else if(t==='save-8301')save8301();else if(t==='open-zone-from-assign'){closeModal();openZoneModal()}});document.addEventListener('keydown',e=>{if(e.key==='Escape'){const m=document.getElementById('modal');if(m.classList.contains('active'))closeModal()}});document.getElementById('modal').addEventListener('click',e=>{if(e.target.id==='modal')closeModal()});function navigateTo(p,el){document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.page').forEach(e=>e.classList.remove('active'));if(el)el.classList.add('active');document.getElementById('page-'+p).classList.add('active');const titles={dashboard:['Dashboard',APP.station?APP.station.name+' ‚Ä¢ Operational':'Not configured'],audio:['Audio Workflow','Configure inputs'],zones:['Zones','Manage zones'],devices:['Devices','Hardware management'],integrations:['Integrations','Connect services'],settings:['Settings','Configuration']};if(titles[p]){document.getElementById('pageTitle').textContent=titles[p][0];document.getElementById('pageSub').textContent=titles[p][1]}}function showToast(m,t='success'){const d=document.createElement('div');d.className='toast '+t;d.textContent=m;document.body.appendChild(d);setTimeout(()=>d.remove(),3000)}function openModal(t,b,f){const m=document.getElementById('modal');m.innerHTML='<div class="modal"><div class="modal-header"><div class="modal-title">'+t+'</div><button class="btn btn-sm btn-sec" data-action="close-modal" style="padding:8px">‚úï</button></div><div class="modal-body">'+b+'</div><div class="modal-footer">'+f+'</div></div>';m.classList.add('active')}function closeModal(){const m=document.getElementById('modal');if(APP.wizard.dirty&&!confirm('Discard changes?'))return;m.classList.remove('active');APP.wizard.dirty=false;APP.editIndex=null}function startWizard(){APP.wizard.step=1;APP.wizard.data=APP.station?{name:APP.station.name,address:APP.station.address||'',subnet:APP.station.subnet||'192.168.1.0/24',inputFire:APP.inputs.find(i=>i.type==='fire')?.id||1,inputMed:APP.inputs.find(i=>i.type==='medical')?.id||2,inputAll:APP.inputs.find(i=>i.type==='all')?.id||3,ip8301:APP.adapters[0]?.ip||'192.168.1.100',multi8301:APP.adapters[0]?.multicast||'239.1.1.1',zones:JSON.parse(JSON.stringify(APP.zones)),routing:JSON.parse(JSON.stringify(APP.routing))}:{zones:[],routing:{fire:[],medical:[],all:[]}};APP.wizard.dirty=false;renderWizard()}function renderWizard(){const s=APP.wizard.step;let b='',f='';if(s===1){b='<div class="form-group"><label class="form-label">Station Name *</label><input class="form-input" id="wizName" value="'+(APP.wizard.data.name||'')+'"/><div class="form-error" id="wizNameErr">Required</div></div><div class="form-group"><label class="form-label">Address</label><input class="form-input" id="wizAddr" value="'+(APP.wizard.data.address||'')+'"/></div><div class="form-group"><label class="form-label">Network Subnet</label><input class="form-input" id="wizSubnet" value="'+(APP.wizard.data.subnet||'192.168.1.0/24')+'"/></div>';f='<button class="btn btn-sec" data-action="close-modal">Cancel</button><button class="btn" data-action="wizard-next">Next ‚Üí</button>'}else if(s===2){const fi=APP.wizard.data.inputFire||1,m=APP.wizard.data.inputMed||2,a=APP.wizard.data.inputAll||3;b='<p style="color:var(--text2);margin-bottom:16px">Map Mach Alert outputs.</p><div class="audio-lane fire"><div class="audio-lane-title">üî• Fire</div><select class="form-select" id="wizFire"><option value="1" '+(fi===1?'selected':'')+'>Line In 1</option><option value="2" '+(fi===2?'selected':'')+'>Line In 2</option><option value="3" '+(fi===3?'selected':'')+'>Line In 3</option></select></div><div class="audio-lane medical"><div class="audio-lane-title">üè• Medical</div><select class="form-select" id="wizMed"><option value="1" '+(m===1?'selected':'')+'>Line In 1</option><option value="2" '+(m===2?'selected':'')+'>Line In 2</option><option value="3" '+(m===3?'selected':'')+'>Line In 3</option></select></div><div class="audio-lane all"><div class="audio-lane-title">üì¢ All-Call</div><select class="form-select" id="wizAll"><option value="1" '+(a===1?'selected':'')+'>Line In 1</option><option value="2" '+(a===2?'selected':'')+'>Line In 2</option><option value="3" '+(a===3?'selected':'')+'>Line In 3</option></select></div>';f='<button class="btn btn-sec" data-action="wizard-prev">‚Üê Prev</button><button class="btn" data-action="wizard-next">Next ‚Üí</button>'}else if(s===3){b='<div class="form-group"><label class="form-label">IP Address *</label><input class="form-input" id="wiz8301IP" value="'+(APP.wizard.data.ip8301||'192.168.1.100')+'"/></div><div class="form-group"><label class="form-label">Multicast</label><input class="form-input" id="wiz8301Multi" value="'+(APP.wizard.data.multi8301||'239.1.1.1')+'"/></div>';f='<button class="btn btn-sec" data-action="wizard-prev">‚Üê Prev</button><button class="btn" data-action="wizard-next">Next ‚Üí</button>'}else if(s===4){b='<p style="color:var(--text2);margin-bottom:16px">Define station zones.</p><button class="btn" data-action="load-template" style="margin-bottom:12px">Load Template</button><div style="display:flex;gap:12px;margin-bottom:16px"><input class="form-input" id="wizZoneName" placeholder="Zone name" style="flex:1"/><button class="btn" data-action="add-zone-wizard">+ Add</button></div><div class="zone-list" id="wizZoneList"></div>';f='<button class="btn btn-sec" data-action="wizard-prev">‚Üê Prev</button><button class="btn" data-action="wizard-next" id="wizNextBtn">Next ‚Üí</button>';setTimeout(()=>renderWizardZones(),0)}else if(s===5){b='<p style="color:var(--text2);margin-bottom:16px">Configure routing.</p><div class="routing-matrix" id="wizRouting"></div>';f='<button class="btn btn-sec" data-action="wizard-prev">‚Üê Prev</button><button class="btn" data-action="wizard-next">Next ‚Üí</button>';setTimeout(()=>renderWizardRouting(),0)}else if(s===6){b='<div style="background:var(--bg3);border-radius:12px;padding:20px"><div style="margin-bottom:12px"><div style="font-size:12px;color:var(--text3)">Station</div><div style="font-weight:600">'+(APP.wizard.data.name||'Unnamed')+'</div></div><div style="margin-bottom:12px"><div style="font-size:12px;color:var(--text3)">Zones</div><div style="font-weight:600">'+(APP.wizard.data.zones||[]).length+'</div></div></div>';f='<button class="btn btn-sec" data-action="wizard-prev">‚Üê Prev</button><button class="btn" data-action="wizard-save">Save Configuration</button>'}openModal('Station Setup - Step '+s+' of 6',b,f)}function wizardNext(){const s=APP.wizard.step;APP.wizard.dirty=true;if(s===1){const n=document.getElementById('wizName');if(!n||!n.value.trim()){n.classList.add('error');document.getElementById('wizNameErr').classList.add('show');return}APP.wizard.data.name=n.value.trim();APP.wizard.data.address=document.getElementById('wizAddr').value.trim();APP.wizard.data.subnet=document.getElementById('wizSubnet').value.trim()}else if(s===2){APP.wizard.data.inputFire=parseInt(document.getElementById('wizFire').value);APP.wizard.data.inputMed=parseInt(document.getElementById('wizMed').value);APP.wizard.data.inputAll=parseInt(document.getElementById('wizAll').value)}else if(s===3){APP.wizard.data.ip8301=document.getElementById('wiz8301IP').value.trim();APP.wizard.data.multi8301=document.getElementById('wiz8301Multi').value.trim()}else if(s===4){if(!APP.wizard.data.zones||APP.wizard.data.zones.length===0){showToast('Add at least one zone','error');return}}APP.wizard.step++;renderWizard()}function wizardPrev(){APP.wizard.step--;renderWizard()}function wizardSave(){APP.inputs.forEach(i=>i.type=null);APP.inputs[APP.wizard.data.inputFire-1].type='fire';APP.inputs[APP.wizard.data.inputMed-1].type='medical';APP.inputs[APP.wizard.data.inputAll-1].type='all';APP.station={name:APP.wizard.data.name,address:APP.wizard.data.address||'',subnet:APP.wizard.data.subnet||''};APP.zones=APP.wizard.data.zones||[];APP.routing=APP.wizard.data.routing||{fire:[],medical:[],all:[]};APP.adapters=[{name:'Primary 8301',ip:APP.wizard.data.ip8301||'192.168.1.100',multicast:APP.wizard.data.multi8301||'239.1.1.1'}];APP.wizard.dirty=false;closeModal();document.getElementById('emptyDash').style.display='none';document.getElementById('activeDash').style.display='block';document.getElementById('emptyAudio').style.display='none';document.getElementById('activeAudio').style.display='block';document.getElementById('emptyZones').style.display='none';document.getElementById('activeZones').style.display='block';document.getElementById('setupBtn').textContent='Reconfigure Station';document.getElementById('settingsName').disabled=false;document.getElementById('settingsName').value=APP.station.name;updateDashboard();renderAudio();renderZones();renderDevices();showToast('Station configured')}function renderWizardZones(){const l=document.getElementById('wizZoneList'),z=APP.wizard.data.zones||[],btn=document.getElementById('wizNextBtn');if(!l)return;if(z.length===0){l.innerHTML='<div style="text-align:center;padding:40px;color:var(--text3)">No zones yet</div>';if(btn)btn.disabled=true;return}if(btn)btn.disabled=false;l.innerHTML=z.map((zn,i)=>'<div class="zone-item"><div class="zone-info"><div class="zone-name">'+zn.name+'</div></div><button class="btn btn-sm btn-danger" data-action="remove-zone-wizard" data-index="'+i+'">Remove</button></div>').join('')}function addZoneWizard(){const inp=document.getElementById('wizZoneName');if(!inp||!inp.value.trim()){showToast('Enter zone name','error');return}const n=inp.value.trim();if(!APP.wizard.data.zones)APP.wizard.data.zones=[];if(APP.wizard.data.zones.some(z=>z.name.toLowerCase()===n.toLowerCase())){showToast('Zone name must be unique','error');return}APP.wizard.data.zones.push({name:n,speakers:[]});inp.value='';renderWizardZones()}function removeZoneWizard(i){if(!APP.wizard.data.zones||!APP.wizard.data.zones[i])return;const n=APP.wizard.data.zones[i].name;APP.wizard.data.zones.splice(i,1);['fire','medical','all'].forEach(t=>{if(!APP.wizard.data.routing[t])APP.wizard.data.routing[t]=[];APP.wizard.data.routing[t]=APP.wizard.data.routing[t].filter(idx=>idx!==i).map(idx=>idx>i?idx-1:idx)});renderWizardZones()}function loadTemplate(){APP.wizard.data.zones=[{name:'Dorm 1',speakers:[]},{name:'Dorm 2',speakers:[]},{name:'Common Area',speakers:[]},{name:'Apparatus Bay',speakers:[]}];renderWizardZones();showToast('Template loaded')}function renderWizardRouting(){const c=document.getElementById('wizRouting');if(!c)return;const z=APP.wizard.data.zones||[],r=APP.wizard.data.routing||{fire:[],medical:[],all:[]};let h='<div class="routing-row header"><div>Zone</div><div>üî• Fire</div><div>üè• Medical</div><div>üì¢ All-Call</div></div>';z.forEach((zn,i)=>{h+='<div class="routing-row"><div>'+zn.name+'</div><div><div class="checkbox '+(r.fire.includes(i)?'checked':'')+'" data-action="toggle-routing" data-type="fire" data-index="'+i+'"></div></div><div><div class="checkbox '+(r.medical.includes(i)?'checked':'')+'" data-action="toggle-routing" data-type="medical" data-index="'+i+'"></div></div><div><div class="checkbox '+(r.all.includes(i)?'checked':'')+'" data-action="toggle-routing" data-type="all" data-index="'+i+'"></div></div></div>'});c.innerHTML=h}function toggleRouting(t,i){if(!APP.wizard.data.routing[t])APP.wizard.data.routing[t]=[];const idx=APP.wizard.data.routing[t].indexOf(i);if(idx>-1)APP.wizard.data.routing[t].splice(idx,1);else APP.wizard.data.routing[t].push(i);renderWizardRouting()}function updateDashboard(){document.getElementById('stat-inputs').textContent='3/3';document.getElementById('stat-zones').textContent=APP.zones.length;document.getElementById('stat-8301').textContent=APP.adapters.length;document.getElementById('stat-speakers').textContent=APP.speakers.length;['fire','med','all'].forEach(t=>{const el=document.getElementById('status-'+t);if(el){el.className='status-indicator good';el.innerHTML='<span>‚óè</span> Active'}});document.getElementById('pageSub').textContent=APP.station?APP.station.name+' ‚Ä¢ Operational':'Not configured'}function renderAudio(){const c=document.getElementById('activeAudio');if(!c)return;const fi=APP.inputs.find(i=>i.type==='fire'),mi=APP.inputs.find(i=>i.type==='medical'),ai=APP.inputs.find(i=>i.type==='all');let h='<div class="card"><div class="card-header"><h3 class="card-title">Audio Inputs</h3></div>';h+='<div class="audio-lane fire"><div class="audio-lane-title">üî• Fire Calls</div><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:13px;color:var(--text2)">Mach Alert Output ‚Üí Focusrite</div><div style="font-weight:600;margin-top:4px">'+(fi?fi.name:'Not assigned')+'</div></div><button class="btn btn-sm" data-action="change-input" data-type="fire">Change</button></div></div>';h+='<div class="audio-lane medical"><div class="audio-lane-title">üè• Medical Calls</div><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:13px;color:var(--text2)">Mach Alert Output ‚Üí Focusrite</div><div style="font-weight:600;margin-top:4px">'+(mi?mi.name:'Not assigned')+'</div></div><button class="btn btn-sm" data-action="change-input" data-type="medical">Change</button></div></div>';h+='<div class="audio-lane all"><div class="audio-lane-title">üì¢ All-Call</div><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:13px;color:var(--text2)">Mach Alert Output ‚Üí Focusrite</div><div style="font-weight:600;margin-top:4px">'+(ai?ai.name:'Not assigned')+'</div></div><button class="btn btn-sm" data-action="change-input" data-type="all">Change</button></div></div>';h+='</div>';h+='<div class="card"><div class="card-header"><h3 class="card-title">Algo 8301 Paging Adapters</h3><button class="btn btn-sm" data-action="add-8301">+ Add Adapter</button></div>';if(APP.adapters.length===0){h+='<div style="text-align:center;padding:40px;color:var(--text3)">No adapters</div>'}else{APP.adapters.forEach((a,i)=>{h+='<div class="adapter-card"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:600">'+a.name+'</div><div style="font-size:12px;color:var(--text3);margin-top:4px;font-family:monospace">IP: '+a.ip+' ‚Ä¢ Multicast: '+a.multicast+'</div></div><div style="display:flex;gap:8px"><button class="btn btn-sm btn-sec" data-action="edit-8301" data-index="'+i+'">Edit</button>'+(APP.adapters.length>1?'<button class="btn btn-sm btn-danger" data-action="remove-8301" data-index="'+i+'">Remove</button>':'')+'</div></div></div>'})}h+='</div>';c.innerHTML=h}function renderZones(){const c=document.getElementById('activeZones');if(!c)return;let h='<div class="card"><div class="card-header"><h3 class="card-title">Zones</h3><button class="btn btn-sm" data-action="add-zone">+ Add Zone</button></div>';if(APP.zones.length===0){h+='<div style="text-align:center;padding:40px;color:var(--text3)">No zones</div>'}else{h+='<div class="zone-list">';APP.zones.forEach((z,i)=>{const sc=z.speakers?z.speakers.length:0;h+='<div class="zone-item"><div class="zone-info"><div class="zone-name">'+z.name+'</div><div class="zone-meta">'+sc+' speaker'+(sc!==1?'s':'')+'</div></div><div style="display:flex;gap:8px"><button class="btn btn-sm btn-sec" data-action="edit-zone" data-index="'+i+'">Edit</button><button class="btn btn-sm btn-danger" data-action="delete-zone" data-index="'+i+'">Delete</button></div></div>'});h+='</div>'}h+='</div>';h+='<div class="card"><div class="card-header"><h3 class="card-title">Routing Matrix</h3></div><div class="routing-matrix">';h+='<div class="routing-row header"><div>Zone</div><div>üî• Fire</div><div>üè• Medical</div><div>üì¢ All-Call</div></div>';APP.zones.forEach((z,i)=>{h+='<div class="routing-row"><div>'+z.name+'</div><div><div class="checkbox readonly '+(APP.routing.fire.includes(i)?'checked':'')+'"></div></div><div><div class="checkbox readonly '+(APP.routing.medical.includes(i)?'checked':'')+'"></div></div><div><div class="checkbox readonly '+(APP.routing.all.includes(i)?'checked':'')+'"></div></div></div>'});h+='</div></div>';c.innerHTML=h}function renderDevices(){const c=document.getElementById('devicesContent');if(!c)return;let h='<div class="card"><div class="card-header"><h3 class="card-title">Network Devices</h3><div style="display:flex;gap:8px"><button class="btn btn-sm" data-action="scan-network" id="scanBtn">üîç Scan Network</button><button class="btn btn-sm" data-action="add-device">+ Add Device</button></div></div>';if(APP.adapters.length>0){h+='<div style="margin-bottom:16px"><div style="font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px">Algo 8301 Adapters</div>';APP.adapters.forEach(a=>{h+='<div class="device-card"><div class="device-icon" style="background:var(--purple);color:white">üì°</div><div class="device-info"><div class="device-name">'+a.name+'</div><div class="device-meta">'+a.ip+'</div></div></div>'});h+='</div>'}if(APP.speakers.length===0){h+='<div style="text-align:center;padding:40px;color:var(--text3)">No speakers discovered</div>'}else{h+='<div style="font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px">Speakers</div>';APP.speakers.forEach((s,i)=>{const z=s.zone!==null&&APP.zones[s.zone]?APP.zones[s.zone].name:'Unassigned';h+='<div class="device-card"><div class="device-icon" style="background:var(--green);color:white">üîä</div><div class="device-info"><div class="device-name">'+s.name+'</div><div class="device-meta">'+s.ip+' ‚Ä¢ '+z+'</div></div><button class="btn btn-sm" data-action="assign-speaker" data-index="'+i+'">Assign</button></div>'})}h+='</div>';c.innerHTML=h}function openZoneModal(i){APP.editIndex=i;const z=i!==undefined?APP.zones[i]:null,isEdit=z!==null;let b='<div class="form-group"><label class="form-label">Zone Name *</label><input class="form-input" id="zoneName" value="'+(z?z.name:'')+'"/><div class="form-error" id="zoneNameErr">Required</div></div>';b+='<div class="form-group"><label class="form-label">Receives Alerts</label><div style="display:flex;flex-direction:column;gap:8px"><label style="display:flex;align-items:center;gap:8px;cursor:pointer"><input type="checkbox" id="zoneFire" '+(z&&APP.routing.fire.includes(i)?'checked':'')+'/> üî• Fire Calls</label><label style="display:flex;align-items:center;gap:8px;cursor:pointer"><input type="checkbox" id="zoneMed" '+(z&&APP.routing.medical.includes(i)?'checked':'')+'/> üè• Medical Calls</label><label style="display:flex;align-items:center;gap:8px;cursor:pointer"><input type="checkbox" id="zoneAll" '+(z&&APP.routing.all.includes(i)?'checked':'')+'/> üì¢ All-Call</label></div></div>';let f='<button class="btn btn-sec" data-action="close-modal">Cancel</button>';if(isEdit)f+='<button class="btn btn-danger" data-action="delete-zone" data-index="'+i+'">Delete</button>';f+='<button class="btn" data-action="save-zone">'+(isEdit?'Save':'Create')+'</button>';openModal((isEdit?'Edit':'Create')+' Zone',b,f)}function saveZone(){const n=document.getElementById('zoneName'),fire=document.getElementById('zoneFire'),med=document.getElementById('zoneMed'),all=document.getElementById('zoneAll');if(!n||!n.value.trim()){n.classList.add('error');document.getElementById('zoneNameErr').classList.add('show');return}const name=n.value.trim(),i=APP.editIndex;if(APP.zones.some((z,idx)=>z.name.toLowerCase()===name.toLowerCase()&&idx!==i)){showToast('Zone name must be unique','error');return}const zoneData={name:name,speakers:i!==undefined&&APP.zones[i]?APP.zones[i].speakers:[]};if(i!==undefined){APP.zones[i]=zoneData}else{APP.zones.push(zoneData)}const zi=i!==undefined?i:APP.zones.length-1;['fire','medical','all'].forEach(t=>{const checked=t==='fire'?fire.checked:t==='medical'?med.checked:all.checked,idx=APP.routing[t].indexOf(zi);if(checked&&idx===-1)APP.routing[t].push(zi);else if(!checked&&idx>-1)APP.routing[t].splice(idx,1)});closeModal();renderZones();updateDashboard();showToast('Zone saved')}function deleteZone(i){if(!APP.zones[i])return;const z=APP.zones[i],assignedSpeakers=APP.speakers.filter(s=>s.zone===i);if(assignedSpeakers.length>0&&APP.zones.length===1){showToast('Cannot delete last zone with assigned speakers','error');return}if(!confirm('Delete zone "'+z.name+'"?'+(assignedSpeakers.length>0?' This will unassign '+assignedSpeakers.length+' speaker(s).':'')))return;assignedSpeakers.forEach(s=>s.zone=null);APP.zones.splice(i,1);['fire','medical','all'].forEach(t=>{APP.routing[t]=APP.routing[t].filter(idx=>idx!==i).map(idx=>idx>i?idx-1:idx)});APP.speakers.forEach(s=>{if(s.zone!==null&&s.zone>i)s.zone--});closeModal();renderZones();renderDevices();updateDashboard();showToast('Zone deleted')}function openDeviceModal(){let b='<div class="form-group"><label class="form-label">Type</label><select class="form-select" id="deviceType"><option value="speaker">Speaker</option><option value="8301">Algo 8301</option></select></div>';b+='<div class="form-group"><label class="form-label">Name *</label><input class="form-input" id="deviceName"/><div class="form-error" id="deviceNameErr">Required</div></div>';b+='<div class="form-group"><label class="form-label">IP Address *</label><input class="form-input" id="deviceIP" placeholder="192.168.1.100"/><div class="form-error" id="deviceIPErr">Invalid IP</div></div>';b+='<div class="form-group"><label class="form-label">Model</label><input class="form-input" id="deviceModel" placeholder="e.g. Algo 8180"/></div>';openModal('Add Device',b,'<button class="btn btn-sec" data-action="close-modal">Cancel</button><button class="btn" data-action="save-device">Add</button>')}function saveDevice(){const n=document.getElementById('deviceName'),ip=document.getElementById('deviceIP'),t=document.getElementById('deviceType'),m=document.getElementById('deviceModel');if(!n||!n.value.trim()){n.classList.add('error');document.getElementById('deviceNameErr').classList.add('show');return}if(!ip||!ip.value.trim()||!/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(ip.value.trim())){ip.classList.add('error');document.getElementById('deviceIPErr').classList.add('show');return}const device={name:n.value.trim(),ip:ip.value.trim(),model:m?m.value.trim():'',zone:null};if(t.value==='speaker'){APP.speakers.push(device);showToast('Speaker added')}else{APP.adapters.push({name:n.value.trim(),ip:ip.value.trim(),multicast:'239.1.1.1'});showToast('Adapter added')}closeModal();renderDevices();renderAudio();updateDashboard()}function openAssignModal(i){if(APP.zones.length===0){openModal('No Zones Available','<p style="color:var(--text2);margin-bottom:16px">Create a zone first.</p>','<button class="btn btn-sec" data-action="close-modal">Cancel</button><button class="btn" data-action="open-zone-from-assign">Create Zone</button>');return}APP.editIndex=i;const s=APP.speakers[i];let b='<div class="form-group"><label class="form-label">Speaker</label><div style="font-weight:600">'+s.name+'</div><div style="font-size:12px;color:var(--text3);margin-top:4px">'+s.ip+'</div></div>';b+='<div class="form-group"><label class="form-label">Assign to Zone *</label><select class="form-select" id="assignZone">';APP.zones.forEach((z,idx)=>{b+='<option value="'+idx+'" '+(s.zone===idx?'selected':'')+'>'+z.name+'</option>'});b+='</select></div>';openModal('Assign Speaker',b,'<button class="btn btn-sec" data-action="close-modal">Cancel</button><button class="btn" data-action="save-assign">Save</button>')}function saveAssign(){const sel=document.getElementById('assignZone'),i=APP.editIndex,s=APP.speakers[i];if(!sel)return;const oldZone=s.zone,newZone=parseInt(sel.value);if(oldZone!==null&&APP.zones[oldZone]&&APP.zones[oldZone].speakers){APP.zones[oldZone].speakers=APP.zones[oldZone].speakers.filter(sp=>sp!==s.name)}s.zone=newZone;if(!APP.zones[newZone].speakers)APP.zones[newZone].speakers=[];if(!APP.zones[newZone].speakers.includes(s.name))APP.zones[newZone].speakers.push(s.name);closeModal();renderDevices();renderZones();showToast('Speaker assigned')}function openInputModal(t){const curr=APP.inputs.find(i=>i.type===t),labels={fire:'Fire Calls',medical:'Medical Calls',all:'All-Call'};let b='<p style="color:var(--text2);margin-bottom:16px">Select input for '+labels[t]+'</p>';b+='<div class="form-group"><label class="form-label">Audio Input *</label><select class="form-select" id="inputSelect">';APP.inputs.forEach(inp=>{const assigned=inp.type?'('+labels[inp.type]+')':'';b+='<option value="'+inp.id+'" '+(curr&&curr.id===inp.id?'selected':'')+'>'+inp.name+' '+assigned+'</option>'});b+='</select></div>';b+='<div id="inputWarning" style="background:var(--orange);color:#000;padding:12px;border-radius:8px;margin-top:12px;display:none;font-size:13px"></div>';APP.editIndex=t;setTimeout(()=>{const sel=document.getElementById('inputSelect');if(sel){sel.addEventListener('change',()=>{const newId=parseInt(sel.value),conflict=APP.inputs.find(i=>i.id===newId&&i.type&&i.type!==t);if(conflict){const w=document.getElementById('inputWarning'),oldInput=APP.inputs.find(i=>i.type===t);w.innerHTML='‚ö†Ô∏è '+conflict.name+' is assigned to '+labels[conflict.type]+'. '+(oldInput?labels[conflict.type]+' will move to '+oldInput.name+'.':'');w.style.display='block'}else{document.getElementById('inputWarning').style.display='none'}})}},0);openModal('Change Audio Input',b,'<button class="btn btn-sec" data-action="close-modal">Cancel</button><button class="btn" data-action="save-input">Save</button>')}function saveInput(){const sel=document.getElementById('inputSelect'),t=APP.editIndex;if(!sel)return;const newId=parseInt(sel.value),oldInput=APP.inputs.find(i=>i.type===t),newInput=APP.inputs.find(i=>i.id===newId),conflict=APP.inputs.find(i=>i.id===newId&&i.type&&i.type!==t);if(conflict&&oldInput){const temp=conflict.type;conflict.type=oldInput.type;oldInput.type=temp}if(oldInput)oldInput.type=null;newInput.type=t;closeModal();renderAudio();updateDashboard();showToast('Input assignment updated')}function open8301Modal(i){APP.editIndex=i;const a=i!==undefined?APP.adapters[i]:null,isEdit=a!==null;let b='<div class="form-group"><label class="form-label">Name *</label><input class="form-input" id="a8301Name" value="'+(a?a.name:'')+'"/><div class="form-error" id="a8301NameErr">Required</div></div>';b+='<div class="form-group"><label class="form-label">IP Address *</label><input class="form-input" id="a8301IP" value="'+(a?a.ip:'')+'"/><div class="form-error" id="a8301IPErr">Invalid IP</div></div>';b+='<div class="form-group"><label class="form-label">Multicast Address</label><input class="form-input" id="a8301Multi" value="'+(a?a.multicast:'239.1.1.1')+'"/></div>';let f='<button class="btn btn-sec" data-action="close-modal">Cancel</button>';if(isEdit&&APP.adapters.length>1)f+='<button class="btn btn-danger" data-action="remove-8301" data-index="'+i+'">Remove</button>';f+='<button class="btn" data-action="save-8301">'+(isEdit?'Save':'Add')+'</button>';openModal((isEdit?'Edit':'Add')+' Algo 8301',b,f)}function save8301(){const n=document.getElementById('a8301Name'),ip=document.getElementById('a8301IP'),m=document.getElementById('a8301Multi'),i=APP.editIndex;if(!n||!n.value.trim()){n.classList.add('error');document.getElementById('a8301NameErr').classList.add('show');return}if(!ip||!ip.value.trim()||!/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(ip.value.trim())){ip.classList.add('error');document.getElementById('a8301IPErr').classList.add('show');return}const adapter={name:n.value.trim(),ip:ip.value.trim(),multicast:m?m.value.trim():'239.1.1.1'};if(i!==undefined){APP.adapters[i]=adapter}else{APP.adapters.push(adapter)}closeModal();renderAudio();renderDevices();updateDashboard();showToast('Adapter '+(i!==undefined?'updated':'added'))}function remove8301(i){if(APP.adapters.length<=1){showToast('Cannot remove last adapter','error');return}if(!confirm('Remove adapter "'+APP.adapters[i].name+'"?'))return;const name=APP.adapters[i].name;APP.adapters.splice(i,1);closeModal();renderAudio();renderDevices();updateDashboard();showToast('Adapter removed')}function scanNetwork(btn){btn.textContent='Scanning...';btn.disabled=true;setTimeout(()=>{APP.speakers.push({name:'Algo 8180-001',ip:'192.168.1.101',zone:null},{name:'Algo 8180-002',ip:'192.168.1.102',zone:null},{name:'Algo 8186-001',ip:'192.168.1.110',zone:null});btn.textContent='üîç Scan Network';btn.disabled=false;renderDevices();updateDashboard();showToast('Found 3 speakers')},2000)}
</script>
</body>
</html>